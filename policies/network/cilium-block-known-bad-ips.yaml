# Cilium Network Policy - Block Known Malicious IPs/CIDRs
# Update the CIDR list with your threat intel feeds
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: block-known-bad-ips
  labels:
    app.kubernetes.io/name: qualys-network-security
    policy-type: threat-intel
spec:
  description: "Block connections to known malicious IP ranges"
  endpointSelector: {}
  egressDeny:
  # Example malicious IP ranges - replace with threat intel
  - toCIDR:
    - "185.220.100.0/24"   # Known Tor exit nodes
    - "185.220.101.0/24"
    - "185.220.102.0/24"
    - "45.33.32.0/24"      # Example C2 infrastructure
  # Block connections to known bulletproof hosting
  - toCIDR:
    - "91.219.236.0/24"
    - "185.234.216.0/24"
---
# Block specific FQDN destinations
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: block-known-bad-domains
  labels:
    app.kubernetes.io/name: qualys-network-security
    policy-type: threat-intel
spec:
  description: "Block connections to known malicious domains"
  endpointSelector: {}
  egressDeny:
  - toFQDNs:
    - matchPattern: "*.onion.*"
    - matchPattern: "*.tor2web.*"
    - matchPattern: "pastebin.com"      # Often used for C2
    - matchPattern: "raw.githubusercontent.com"  # Payload hosting
    - matchPattern: "*.ngrok.io"        # Tunnel services
    - matchPattern: "*.serveo.net"
    - matchPattern: "*.portmap.io"
